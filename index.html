<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Line Striping by Milepost</title>

  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 12px;
      max-width: 520px;
    }

    .row { margin-bottom: 8px; }

    label {
      display: inline-block;
      width: 95px;
      font-weight: 600;
    }

    input, select {
      width: 180px;
      padding: 4px 6px;
    }

    button {
      margin-top: 10px;
      padding: 6px 12px;
      cursor: pointer;
    }

    .result {
      margin-top: 14px;
      font-size: 16px;
      font-weight: 700;
    }

    #error {
      margin-top: 8px;
      color: #c62828;
      font-weight: 600;
    }
  </style>
</head>

<body>
  <h3>Line Striping Length by Milepost</h3>

  <div class="row">
    <label for="route">Route:</label>
    <select id="route">
      <option value="">-- Select Route --</option>
    </select>
  </div>

  <div class="row">
    <label for="startMP">Start MP:</label>
    <input id="startMP" type="number" step="0.001" />
  </div>

  <div class="row">
    <label for="endMP">End MP:</label>
    <input id="endMP" type="number" step="0.001" />
  </div>

  <button onclick="calculate()">Calculate</button>

  <div id="error"></div>
  <div class="result" id="yellowResult"></div>
  <div class="result" id="whiteResult"></div>

  <script>
    const FEATURE_SERVICE_QUERY_URL =
      "https://services3.arcgis.com/hyLf0m7qTkMThtUP/arcgis/rest/services/Marking_Lines_ExportFeatures/FeatureServer/0/query";

    const BEG_FIELD   = "Beg_MP";
    const END_FIELD   = "End_MP";
    const ROUTE_FIELD = "Route";
    const COLOR_FIELD = "Color";

    // ----------------------------------------------------------
    // LOAD ROUTES INTO DROPDOWN
    // ----------------------------------------------------------
    async function loadRoutes() {
      const params = new URLSearchParams({
        f: "json",
        where: "1=1",
        outFields: ROUTE_FIELD,
        returnDistinctValues: "true",
        returnGeometry: "false"
      });

      const resp = await fetch(FEATURE_SERVICE_QUERY_URL + "?" + params);
      const data = await resp.json();

      const routeSelect = document.getElementById("route");

      if (data.features) {
        const routes = data.features
          .map(f => f.attributes[ROUTE_FIELD])
          .filter(v => v !== null && v !== "")
          .sort();

        for (const r of routes) {
          const opt = document.createElement("option");
          opt.value = r;
          opt.textContent = r;
          routeSelect.appendChild(opt);
        }
      }
    }

    // ----------------------------------------------------------
    // CALCULATION
    // ----------------------------------------------------------
    async function calculate() {
      const startMP = Number(startMPInput.value);
      const endMP   = Number(endMPInput.value);
      const route   = routeSelect.value;

      error.textContent = "";
      yellowResult.textContent = "";
      whiteResult.textContent = "";

      if (!route) {
        error.textContent = "Please select a route.";
        return;
      }
      if (isNaN(startMP) || isNaN(endMP) || endMP <= startMP) {
        error.textContent = "Enter a valid Start MP and End MP.";
        return;
      }

      let where =
        `${END_FIELD} >= ${startMP} AND ${BEG_FIELD} <= ${endMP} AND ${ROUTE_FIELD} = '${route}'`;

      const params = new URLSearchParams({
        f: "json",
        where,
        outFields: `${BEG_FIELD},${END_FIELD},${COLOR_FIELD}`,
        returnGeometry: "false"
      });

      const resp = await fetch(FEATURE_SERVICE_QUERY_URL + "?" + params);
      const data = await resp.json();

      let yellowFeet = 0;
      let whiteFeet  = 0;

      if (data.features) {
        for (const f of data.features) {
          const gStart = Number(f.attributes[BEG_FIELD]);
          const gEnd   = Number(f.attributes[END_FIELD]);
          const color  = f.attributes[COLOR_FIELD];

          const overlap =
            Math.max(0, Math.min(gEnd, endMP) - Math.max(gStart, startMP));

          const feet = overlap * 5280;

          if (color === "Yellow") yellowFeet += feet;
          if (color === "White")  whiteFeet  += feet;
        }
      }

      yellowResult.textContent =
        `Yellow Striping: ${yellowFeet.toFixed(2)} ft`;

      whiteResult.textContent =
        `White Striping: ${whiteFeet.toFixed(2)} ft`;
    }

    // ----------------------------------------------------------
    // INIT
    // ----------------------------------------------------------
    const routeSelect   = document.getElementById("route");
    const startMPInput  = document.getElementById("startMP");
    const endMPInput    = document.getElementById("endMP");
    const error         = document.getElementById("error");
    const yellowResult  = document.getElementById("yellowResult");
    const whiteResult   = document.getElementById("whiteResult");

    loadRoutes();
  </script>
</body>
</html>
